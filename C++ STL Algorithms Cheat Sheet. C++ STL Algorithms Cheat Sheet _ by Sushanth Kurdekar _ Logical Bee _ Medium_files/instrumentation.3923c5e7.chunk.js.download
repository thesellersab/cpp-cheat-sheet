(window.webpackJsonp=window.webpackJsonp||[]).push([[65],{"./src/framework/perf/PerformanceLogger.ts":function(e,n,r){"use strict";r.r(n);var t=r("./node_modules/opentracing/lib/index.js"),o=r("./node_modules/react/index.js"),i=r("./node_modules/react-redux/es/index.js"),s=r("./src/components/session/useFlag.tsx"),c=r("./src/framework/reporter/performance.tsx"),a=r("./src/routes/RoutingContext.tsx"),u=r("./src/store/actions/debug.ts"),l=r("./src/store/selectors/session.ts"),d=r("./src/util/performance.ts"),f=r("./node_modules/@babel/runtime/helpers/slicedToArray.js"),p=r.n(f),g=r("./node_modules/@babel/runtime/helpers/defineProperty.js"),b=r.n(g),m=r("./src/log/datapupLogger.ts"),v=r("./src/util/observable/extras.ts"),_=function(e){return function(n){return b()({},e,n)}};n.default=function(){var e,n;return n={glyph_embed_commands:null!==(e=Object(s.c)().glyph_embed_commands)&&void 0!==e?e:"control"},o.useEffect((function(){var e=Object(v.a)(d.f,d.d,d.b).map((function(e){var n=p()(e,3),r=n[0],t=n[1],o=n[2];return{responseEndToLCP:new d.a(r.response.end,t.end),responseEndToFCP:new d.a(r.response.end,o.end)}})),r=Object(v.a)(d.f,d.c.map(_("fid")),d.b.map(_("fcp")),d.d.map(_("lcp")),e);d.h.observe((function(e){e||r.observe((function(e){var r=e.reduce((function(e,n){return Object.assign(e,n)}),{}),t=Object.keys(r).reduce((function(e,n){var t=r[n].duration;return e[n]=t%1==0?t:Number(t.toFixed(1)),e}),{}),o=document.children[0],i={html:null==o?void 0:o.innerHTML.length,redux:JSON.stringify(window.__PRELOADED_STATE__).length,apollo:JSON.stringify(window.__APOLLO_STATE__).length};m.a.log("client hydrated",{perf:t,sizes:i,experimentFlags:n})}))})),d.g.observe((function(e){return m.a.log("client resource sizes",{resources:e})}))}),[]),function(){var e,n,r=Object(i.f)((function(e){return e.tracing.tracer})),f=Object(i.f)((function(e){return e.tracing.originalSpan})),p=Object(i.f)((function(e){return e.client.isBot})),g=Object(i.f)((function(e){return e.client.isCustomDomain})),b=Object(i.f)((function(e){return e.auroraPage.isAuroraPageEnabled})),m=Object(i.f)((function(e){return e.session.user.id})),v=Object(i.f)((function(e){return e.config.performanceTags})),_=Object(i.e)(),h=Object(a.c)(),O=Object(s.c)(),j=null!==(e=O.glyph_embed_commands)&&void 0!==e?e:"control",w=null!==(n=O.enable_lite_clientele)&&void 0!==n&&n,x=Object(c.c)({useClientele:w});o.useEffect((function(){var e;if(r&&x&&!p){var n=h(window.location.pathname),o=null!==(e=null==n?void 0:n.route.metricName)&&void 0!==e?e:"unidentified",i={"user.logged_in":Object(l.a)(m),"req.route_name":o,"req.route":o,"req.glyph_embed":j,"req.is_custom_domain":g};v.forEach((function(e){return i["req.".concat(e)]=1}));var s={loggedIn:Object(l.a)(m),route:o,auroraPage:b,withinWriterProfileRedesignExperiment:v.includes("enable_writer_profile_redesign")},c=function(e){return Math.round(1e3*e)},a=function(e,n,t,o){var s=t.start,a=t.end,u=r.startSpan("timing.".concat(n),{childOf:e,tags:i}).setBeginMicros(c(s)).setEndMicros(c(a));return null!=o&&o(u),u.finish(),u};d.f.observe((function(e){var n,o,l,d;x.reportRender(s,e);var p=r.startSpan("timing.navigation",{references:f?[Object(t.followsFrom)(f)]:void 0,tags:i}).setBeginMicros(c(e.load.start)).setEndMicros(c(e.load.end)).log({redirect_count:null!==(n=null===(o=window)||void 0===o||null===(l=o.performance)||void 0===l||null===(d=l.navigation)||void 0===d?void 0:d.redirectCount)&&void 0!==n?n:0});a(p,"beforeDomainLookup",e.beforeDomainLookup),a(p,"domainLookup",e.domainLookup),a(p,"connect",e.connect),a(p,"request",e.request),a(p,"response",e.response),a(p,"processing",e.processing);var g=e.overallFCP,b=e.client,m=e.render;null!=g&&a(p,"firstContentfulPaint",g),null!=b&&a(p,"client",b,(function(e){null!=m&&a(e,"render",m)})),p.finish(),_(Object(u.f)(p.generateTraceURL()))})),d.b.observe((function(e){x.reportFirstContentfulPaint(s,e),r.startSpan("timing.firstContentfulPaint.v2",{references:f?[Object(t.followsFrom)(f)]:void 0,tags:i}).setBeginMicros(c(e.start)).setEndMicros(c(e.end)).finish()})),d.d.observe((function(e){x.reportLargestContentfulPaint(s,e),r.startSpan("timing.largestContentfulPaint",{references:f?[Object(t.followsFrom)(f)]:void 0,tags:i}).setBeginMicros(c(e.start)).setEndMicros(c(e.end)).finish()})),d.h.observe((function(e){e&&x.reportUnsupportedPerfObserver(s)})),d.c.observe((function(e){x.reportInput(s,e),r.startSpan("timing.input.first.delay",{references:f?[Object(t.followsFrom)(f)]:void 0,tags:i}).setBeginMicros(c(e.start)).setEndMicros(c(e.end)).finish()}))}}),[r])}(),null}},"./src/util/observable/extras.ts":function(e,n,r){"use strict";r.d(n,"a",(function(){return o}));var t=r("./src/util/observable/index.ts");function o(){for(var e=new t.a,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];if(0===r.length)return e;var i=r.map((function(){return[]}));return r.forEach((function(n,r){n.observe((function(n){i[r].push(n),i.every((function(e){return e.length>0}))&&e.set(i.map((function(e){return e.shift()})))}))})),e}},"./src/util/tracing.ts":function(e,n,r){"use strict";r.r(n),r.d(n,"init",(function(){return i})),r.d(n,"extractSpan",(function(){return s}));var t=r("./node_modules/lightstep-tracer/browser.js"),o=r("./node_modules/opentracing/lib/index.js"),i=function(e){var n=e.name,r=e.host,i=e.token,s=e.appVersion,c=new t.Tracer({component_name:n,xhr_instrumentation:!1,access_token:i,collector_host:r,default_span_tags:{"component.version":s}});return Object(o.initGlobalTracer)(c),c},s=function(e,n){if(n)return e.extract(o.FORMAT_HTTP_HEADERS,n)}}}]);
//# sourceMappingURL=instrumentation.3923c5e7.chunk.js.map